import{ref}from"vue";export function useImageUpload(){const e=ref([]),l=ref("idle"),a=ref(null);return{items:e,status:l,error:a,addFiles:function(l){Array.from(l).forEach((l=>{e.value.push({file:l,preview:URL.createObjectURL(l),fileUrl:null})}))},uploadImages:async function(){if(e.value.length){a.value=null,l.value="uploading";try{await Promise.all(e.value.map((async e=>{if(!e.file.type.startsWith("image/"))throw new Error("Only image files are allowed");const{uploadUrl:l,fileUrl:a}=await $fetch("/api/presign",{method:"POST",body:{fileName:e.file.name,fileType:e.file.type}});await fetch(l,{method:"PUT",headers:{"Content-Type":e.file.type},body:e.file}),e.fileUrl=a}))),l.value="done"}catch(e){a.value=e.message||"Upload failed",l.value="error"}}},reset:function(){e.value.forEach((e=>URL.revokeObjectURL(e.preview))),e.value=[],l.value="idle",a.value=null}}}